#!/home/beer/projects/baseclue/codev/env/bin/python

"""
Use cases

codev init --template=[template]
    -- create new project

codev install [environment] [configuration] [version]
    -- install project

codev start [environment] [configuration] [version]
    -- start installed project

codev stop [environment] [configuration] [version]
    -- stop installed project

codev run [script] [environment] [configuration] [version]
"""
from json import loads
import sys
import select

import click

from codev.perform.cli import command, main


@command(
    help='Deploy project.',
    confirmation="Deploy project '{project}' to environment '{environment}' in configuration '{configuration}' at source '{source_transition}'?"
)
def deploy(installation):
    """
    Deploy project

    :param installation:
    :type installation: codev.installation.Installation
    :return:
    :rtype: bool
    """
    if select.select([sys.stdin,], [], [], 0.0)[0]:
        load_vars = loads(sys.stdin.read())
    else:
        load_vars = {}
    return installation.deploy(load_vars)


@command(help='Execute command in project context in isol ation.')
@click.argument('command', nargs=-1)
def execute(installation, command):
    """
    :param installation:
    :type installation: codev.installation.Installation
    :param command:
    :type command: str
    :return:
    :rtype: bool
    """

    if select.select([sys.stdin,], [], [], 0.0)[0]:
        arguments = loads(sys.stdin.read())
    else:
        arguments = {}
    return installation.execute(' '.join(command), arguments)

if __name__ == "__main__":
    main()

